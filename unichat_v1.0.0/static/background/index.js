var e,t;"function"==typeof(e=globalThis.define)&&(t=e,e=null),function(t,r,n,o,s){var a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},i="function"==typeof a[o]&&a[o],l=i.cache||{},c="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function u(e,r){if(!l[e]){if(!t[e]){var n="function"==typeof a[o]&&a[o];if(!r&&n)return n(e,!0);if(i)return i(e,!0);if(c&&"string"==typeof e)return c(e);var s=Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}f.resolve=function(r){var n=t[e][1][r];return null!=n?n:r},f.cache={};var d=l[e]=new u.Module(e);t[e][0].call(d.exports,f,d,d.exports,this)}return l[e].exports;function f(e){var t=f.resolve(e);return!1===t?{}:u(t)}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=t,u.cache=l,u.parent=i,u.register=function(e,r){t[e]=[function(e,t){t.exports=r},{}]},Object.defineProperty(u,"root",{get:function(){return a[o]}}),a[o]=u;for(var d=0;d<r.length;d++)u(r[d]);if(n){var f=u(n);"object"==typeof exports&&"undefined"!=typeof module?module.exports=f:"function"==typeof e&&e.amd?e(function(){return f}):s&&(this[s]=f)}}({cSEtw:[function(e,t,r){e("7a58c12bdb9383cf").register(JSON.parse('{"abzv4":"index.js","6PKVy":"styling.6686b60f.js","hgTsr":"main.e29b198b.js"}'))},{"7a58c12bdb9383cf":"e0BGj"}],e0BGj:[function(e,t,r){var n={};t.exports.register=function(e){for(var t=Object.keys(e),r=0;r<t.length;r++)n[t[r]]=e[t[r]]},t.exports.resolve=function(e){var t=n[e];if(null==t)throw Error("Could not resolve bundle with id "+e);return t}},{}],kgW6q:[function(e,t,r){e("../../../src/background"),e("./main-world-scripts")},{"../../../src/background":"fx8Od","./main-world-scripts":"8ZbMf"}],fx8Od:[function(e,t,r){var n=e("~src/lib/translator"),o=e("~src/lib/networkRulesUpdator"),s=e("~src/lib/storage"),a=e("~src/lib/config");(0,o.initializePrefHandlerForDynamicDNR)().then(()=>{console.log("Dynamic rules were set")}),chrome.tabs.onUpdated.addListener(async(e,t)=>{if("complete"!==t.status)return;let r=await chrome.tabs.get(e);r&&r.url&&r.url.startsWith("http")&&await chrome.scripting.executeScript({target:{tabId:e,allFrames:!0},world:"MAIN",args:[chrome.runtime.id],func:e=>{window.__UNICHAT_ID__=e}})}),chrome.runtime.onMessageExternal.addListener(async(e,t,r)=>{let o=await (0,s.getData)("settings",a.defaultSettings);switch(e.action){case"translate":let{text:i}=await (0,n.translate)(e.data,{to:o.primaryLanguage});r(i);break;case"translate-outgoing":let{text:l}=await (0,n.translate)(e.data,{to:o.secondaryLanguage});r(l);break;case"open-settings":chrome.runtime.openOptionsPage()}})},{"~src/lib/translator":"l9AGY","~src/lib/networkRulesUpdator":"9p5pd","~src/lib/storage":"eOtHU","~src/lib/config":"43oYR"}],l9AGY:[function(e,t,r){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r),n.export(r,"translate",()=>a),n.export(r,"Translator",()=>i);var o=e("./helpers.js");let s={from:"auto",to:"en",host:"translate.google.com"};async function a(e,t){return new i(e,t).translate()}class i{constructor(e,t){this.inputText=e,this.options=Object.assign({},s,t)}async translate(){let e=this.buildUrl(),t=this.buildFetchOptions(),r=await fetch(e,t);if(!r.ok)throw await this.buildError(r);let n=await r.json(),o=this.buildResText(n);return{text:o,raw:n}}buildUrl(){let{host:e}=this.options;return`https://${e}/translate_a/single?${this.buildBody()}&dt=at&dt=bd&dt=ex&dt=ld&dt=md&dt=qca&dt=rw&dt=rm&dt=ss&dt=t`}buildBody(){let{from:e,to:t}=this.options,r={sl:e,tl:t,q:this.inputText,client:"gtx",ie:"UTF-8",oe:"UTF-8",otf:"1",dj:"1",ssel:"0",tsel:"0",kc:"7"};return new URLSearchParams(r).toString()}buildFetchOptions(){let{fetchOptions:e}=this.options,t=Object.assign({},e);return t.method="GET",t}buildResText({sentences:e}){return e.filter(e=>"trans"in e).map(e=>e.trans).join("")}async buildError(e){if(429===e.status){let t=await e.text(),{ip:r,time:n,url:s}=(0,o.extractTooManyRequestsInfo)(t),a=`${e.statusText} IP: ${r}, Time: ${n}, Url: ${s}`;throw Error(`Error ${e.status}: ${a}`)}throw Error(`Error ${e.status}: ${e.statusText}`)}}},{"./helpers.js":"1Tcbg","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],"1Tcbg":[function(e,t,r){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");function o(e){let t=e.match(/IP address: (.+?)<br>/)?.[1]||"",r=e.match(/Time: (.+?)<br>/)?.[1]||"",n=(e.match(/URL: (.+?)<br>/)?.[1]||"").replace(/&amp;/g,"&");return{ip:t,time:r,url:n}}n.defineInteropFlag(r),n.export(r,"extractTooManyRequestsInfo",()=>o)},{"@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],f6DG4:[function(e,t,r){r.interopDefault=function(e){return e&&e.__esModule?e:{default:e}},r.defineInteropFlag=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.exportAll=function(e,t){return Object.keys(e).forEach(function(r){"default"===r||"__esModule"===r||t.hasOwnProperty(r)||Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[r]}})}),t},r.export=function(e,t,r){Object.defineProperty(e,t,{enumerable:!0,get:r})}},{}],"9p5pd":[function(e,t,r){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r),n.export(r,"initializePrefHandlerForDynamicDNR",()=>a);var o=chrome.declarativeNetRequest.RuleActionType,s=chrome.declarativeNetRequest.HeaderOperation;async function a(){let e=await chrome.declarativeNetRequest.getDynamicRules();console.log(e);let t=e.map(e=>e.id);await chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:t,addRules:[{id:1,action:{type:o.MODIFY_HEADERS,requestHeaders:[{header:"Origin",operation:s.REMOVE}]},condition:{urlFilter:"https://translate.google.com/*"}}]})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],eOtHU:[function(e,t,r){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r),n.export(r,"setData",()=>o),n.export(r,"getData",()=>s);let o=(e,t)=>new Promise(r=>{chrome.storage.local.set({[e]:t},r)}),s=(e,t)=>new Promise(r=>{chrome.storage.local.get(e,n=>{if(void 0!==n[e])return r(n[e]);r(t)})})},{"@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],"43oYR":[function(e,t,r){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r),n.export(r,"defaultSettings",()=>o);let o={primaryLanguage:"en",secondaryLanguage:"vi"}},{"@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],"8ZbMf":[function(e,t,r){var n=e("@parcel/transformer-js/src/esmodule-helpers.js"),o=e("url:../../../src/contents/styling"),s=n.interopDefault(o),a=e("url:../../../src/contents/main"),i=n.interopDefault(a);chrome.scripting.registerContentScripts([{id:"srcContentsStyling",js:[(0,s.default).split("/").pop().split("?")[0]],matches:["*://*.facebook.com/*","*://*.messenger.com/*"],runAt:"document_idle",world:"MAIN"},{id:"srcContentsMain",js:[(0,i.default).split("/").pop().split("?")[0]],matches:["*://*.facebook.com/*","*://*.messenger.com/*"],runAt:"document_start",world:"MAIN"}]).catch(e=>{})},{"url:../../../src/contents/styling":"1Drhe","url:../../../src/contents/main":"2qcnO","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],"1Drhe":[function(e,t,r){t.exports=e("cc52d96df766dd58").getBundleURL("abzv4")+"../../"+e("34c040f1bae7e726").resolve("6PKVy")},{cc52d96df766dd58:"e5Rdr","34c040f1bae7e726":"e0BGj"}],e5Rdr:[function(e,t,r){var n={};function o(e){return(""+e).replace(/^((?:https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/.+)\/[^/]+$/,"$1")+"/"}r.getBundleURL=function(e){var t=n[e];return t||(t=function(){try{throw Error()}catch(t){var e=(""+t.stack).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/[^)\n]+/g);if(e)return o(e[2])}return"/"}(),n[e]=t),t},r.getBaseURL=o,r.getOrigin=function(e){var t=(""+e).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/[^/]+/);if(!t)throw Error("Origin not found");return t[0]}},{}],"2qcnO":[function(e,t,r){t.exports=e("8a942cc3021754").getBundleURL("abzv4")+"../../"+e("a50a17e1fadac1cb").resolve("hgTsr")},{"8a942cc3021754":"e5Rdr",a50a17e1fadac1cb:"e0BGj"}]},["cSEtw","kgW6q"],"kgW6q","parcelRequire7277"),globalThis.define=t;